
<!-- saved from url=(0040)http://newtest.ukryama.com/temp/test.php -->
<html><body><div class="webkit-line-gutter-backdrop"></div><table><tbody><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><span class="webkit-html-comment">&lt;?php</span></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><span class="webkit-html-comment"><br></span></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><span class="webkit-html-comment">/**</span></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><span class="webkit-html-comment"> * Comment class file.</span></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><span class="webkit-html-comment"> *</span></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><span class="webkit-html-comment"> * @author Dmitry Zasjadko &lt;segoddnja@gmail.com&gt;</span></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"> * @link https://github.com/segoddnja/ECommentable</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"> */</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">/**</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"> * Model, representing comment</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"> *</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"> * @version 1.0</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"> * @package Comments module</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"> */</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">/**</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"> *</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"> * The followings are the available columns in table '{{comments}}':</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"> * @property string $owner_name</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"> * @property integer $owner_id</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"> * @property integer $id</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"> * @property integer $parent_id</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"> * @property integer $creator_id</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"> * @property string $user_name</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"> * @property string $user_email</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"> * @property string $comment_text</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"> * @property integer $create_time</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"> * @property integer $update_time</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"> * @property integer $status</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"> * @property string $link</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"> * </td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"> */</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">class Comment extends CActiveRecord {</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    /*</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">     * Comment statuses</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">     */</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    const STATUS_NOT_APPROVED = 0;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    const STATUS_APPROVED = 1;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    const STATUS_DELETED = 2;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    /*</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">     * @var captcha code handler</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">     */</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    public $verifyCode;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    /*</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">     * @var captcha action</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">     */</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    public $captchaAction;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    /*</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">     * Holds current model config</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">     */</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    private $_config;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    /*</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">     * Holds comments owner model</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">     */</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    private $_ownerModel = false;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    private $_statuses = array(</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        self::STATUS_NOT_APPROVED =&gt; 'Pending',</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        self::STATUS_APPROVED =&gt; 'Active',</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        self::STATUS_DELETED =&gt; 'Trashed'</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    );</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    /**</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">     * Returns the static model of the specified AR class.</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">     * @return Comments the static model class</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">     */</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    public static function model($className = __CLASS__) {</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        return parent::model($className);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    }</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    /**</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">     * @return string the associated database table name</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">     */</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    public function tableName() {</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        return '{{comments}}';</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    }</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    /**</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">     * @return array validation rules for model attributes.</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">     */</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    public function rules() {</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        //get comments module</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        //$commentsModule = Yii::app()-&gt;getModule('comments');</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        //get model config for comments module</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        //$modelConfig = $commentsModule-&gt;getModelConfig($this);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        $rules = array(</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            array('owner_name, owner_id, comment_text', 'required'),</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            array('owner_id, parent_id, create_time, update_time, status, count', 'numerical', 'integerOnly' =&gt; true),</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            array('owner_name', 'length', 'max' =&gt; 50),</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            array('owner_name, creator_name, user_name, user_email, verifyCode', 'checkConfig'),</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            array('link, creator_id, count', 'safe'),</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            // The following rule is used by search().</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            // Please remove those attributes that should not be searched.</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            array('owner_name, owner_id, id, parent_id, creator_id, user_name, user_email, comment_text, create_time, update_time, status, link', 'safe', 'on' =&gt; 'search'),</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        );</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        return $rules;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    }</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    /**</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">     * @return array relational rules.</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">     */</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    public function relations() {</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        $relations = array(</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            'parent' =&gt; array(self::BELONGS_TO, 'Comment', 'parent_id'),</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            'childs' =&gt; array(self::HAS_MANY, 'Comment', 'parent_id'),</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        );</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        $userConfig = Yii::app()-&gt;getModule('comments')-&gt;userConfig;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        //if defined in config class exists</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        if (isset($userConfig['class']) &amp;&amp; class_exists($userConfig['class'])) {</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            $relations = array_merge($relations, array(</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">                'user' =&gt; array(self::BELONGS_TO, $userConfig['class'], 'creator_id'),</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">                    ));</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        }</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        return $relations;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    }</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    public function behaviors() {</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        return array(</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            'CTimestampBehavior' =&gt; array(</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">                'class' =&gt; 'zii.behaviors.CTimestampBehavior',</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            )</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        );</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    }</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    /**</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">     * @return array customized attribute labels (name=&gt;label)</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">     */</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    public function attributeLabels() {</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        return array(</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            'owner_name' =&gt; Yii::t('CommentsModule.msg', 'Owner'),</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            'owner_id' =&gt; Yii::t('CommentsModule.msg', 'Owner ID'),</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            'id' =&gt; 'Comment',</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            'parent_id' =&gt; 'Parent Comment',</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            'creator_id' =&gt; 'Registered User',</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            'user_name' =&gt; Yii::t('CommentsModule.msg', 'Display Name'),</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            'user_email' =&gt; Yii::t('CommentsModule.msg', 'Email Address'),</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            'comment_text' =&gt; Yii::t('CommentsModule.msg', 'Comment Text'),</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            'create_time' =&gt; Yii::t('CommentsModule.msg', 'Create Time'),</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            'update_time' =&gt; Yii::t('CommentsModule.msg', 'Update Time'),</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            'status' =&gt; Yii::t('CommentsModule.msg', 'Status'),</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            'link' =&gt; Yii::t('CommentsModule.msg', 'Link'),</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            'count' =&gt; Yii::t('CommentsModule.msg', 'Comment #'),</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            'verifyCode' =&gt; Yii::t('CommentsModule.msg', 'Verification Code'),</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        );</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    }</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    /**</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">     * Retrieves a list of models based on the current search/filter conditions.</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">     * @return CActiveDataProvider the data provider that can return the models based on the search/filter conditions.</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">     */</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    public function search() {</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        // Warning: Please modify the following code to remove attributes that</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        // should not be searched.</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        $criteria = new CDbCriteria;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        $criteria-&gt;compare('owner_name', $this-&gt;owner_name, true);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        $criteria-&gt;compare('owner_id', $this-&gt;owner_id);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        $criteria-&gt;compare('id', $this-&gt;id);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        $criteria-&gt;compare('parent_id', $this-&gt;parent_id);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        $criteria-&gt;compare('creator_id', $this-&gt;creator_id);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        $criteria-&gt;compare('user_name', $this-&gt;user_name, true);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        $criteria-&gt;compare('user_email', $this-&gt;user_email, true);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        $criteria-&gt;compare('comment_text', $this-&gt;comment_text, true);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        $criteria-&gt;compare('create_time', $this-&gt;create_time);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        $criteria-&gt;compare('update_time', $this-&gt;update_time);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        $criteria-&gt;compare('t.status', $this-&gt;status);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        $criteria-&gt;compare('t.link', $this-&gt;link);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        $relations = $this-&gt;relations();</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        //if User model has been configured</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        if (isset($relations['user']))</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            $criteria-&gt;with = 'user';</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        return new CActiveDataProvider($this, array(</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">                    'criteria' =&gt; $criteria,</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">                    'pagination' =&gt; array(</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">                        'pageSize' =&gt; 30,</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">                    ),</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">                ));</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    }</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    /**</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">     * Checks config</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">     * This is the 'checkConfig' validator as declared in rules().</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">     */</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    //public function checkConfig($attribute,$params)</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    public function checkConfig($attribute) {</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        //if owner_name class exists in configuration</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        if (count($this-&gt;config) === 0) {</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            if ($attribute === 'owner_name')</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">                $this-&gt;addError($attribute, Yii::t('CommentsModule.msg', 'Comments can\'t be added to this content.'));</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            return;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        }</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        //if only registered users can post comments</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        if ($attribute === 'creator_id' &amp;&amp; ($this-&gt;config['registeredOnly'] || !Yii::app()-&gt;user-&gt;isGuest)) {</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            unset($this-&gt;user_email, $this-&gt;user_name);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            $numberValidator = new CNumberValidator();</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            $numberValidator-&gt;allowEmpty = false;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            $numberValidator-&gt;integerOnly = true;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            $numberValidator-&gt;attributes = array('creator_id');</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            $numberValidator-&gt;validate($this);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        }</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        //if se captcha validation on posting</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        if ($attribute === 'verifyCode' &amp;&amp; $this-&gt;config['useCaptcha']) {</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            $captchaValidator = new CCaptchaValidator();</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            $captchaValidator-&gt;caseSensitive = false;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            $captchaValidator-&gt;captchaAction = CommentsModule::CAPTCHA_ACTION_ROUTE;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            $captchaValidator-&gt;allowEmpty = !CCaptcha::checkRequirements();</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            $captchaValidator-&gt;attributes = array('verifyCode');</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            $captchaValidator-&gt;validate($this);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        }</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        //if not only registered users can post comments and current user is guest</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        if (($attribute === 'user_name' || $attribute === 'user_email') &amp;&amp; (!$this-&gt;config['registeredOnly'] &amp;&amp; Yii::app()-&gt;user-&gt;isGuest)) {</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            unset($this-&gt;creator_id);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            $requiredValidator = new CRequiredValidator();</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            $requiredValidator-&gt;attributes = array($attribute);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            $requiredValidator-&gt;validate($this);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            $stringValidator = new CStringValidator();</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            $stringValidator-&gt;max = 128;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            $stringValidator-&gt;attributes = array($attribute);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            $stringValidator-&gt;validate($this);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            if ($attribute === 'user_email') {</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">                $emailValidator = new CEmailValidator();</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">                $emailValidator-&gt;attributes = array('user_email');</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">                $emailValidator-&gt;validate($this);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            }</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        }</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    }</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    /*</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">     * Return array with prepared comments for given modelName and id</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">     * @return Comment array array with comments </td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">     */</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    public function getCommentsTree() {</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        $criteria = new CDbCriteria;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        $criteria-&gt;compare('owner_name', $this-&gt;owner_name);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        $criteria-&gt;compare('owner_id', $this-&gt;owner_id);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        $criteria-&gt;compare('t.status', '&lt;&gt;' . self::STATUS_DELETED);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        $criteria-&gt;order = 'parent_id, create_time ';</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        if (count($this-&gt;config)) {</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            if ($this-&gt;config['orderComments'] === 'ASC' || $this-&gt;config['orderComments'] === 'DESC')</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">                $criteria-&gt;order .= $this-&gt;config['orderComments'];</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            //if premoderation is seted and current user isn't superuser</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            if ($this-&gt;config['premoderate'] &amp;&amp; $this-&gt;evaluateExpression($this-&gt;config['isSuperuser']) === false)</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">                $criteria-&gt;compare('t.status', self::STATUS_APPROVED);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        }</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        $relations = $this-&gt;relations();</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        //if User model has been configured</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        if (isset($relations['user']))</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            $criteria-&gt;with = 'user';</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        $comments = self::model()-&gt;findAll($criteria);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        return $this-&gt;buildTree($comments);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    }</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    public function beforeValidate() {</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        if (($this-&gt;creator_id === null || $this-&gt;creator_id===0) &amp;&amp; Yii::app()-&gt;user-&gt;isGuest === false)</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            $this-&gt;creator_id = Yii::app()-&gt;user-&gt;id;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        return parent::beforeValidate();</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    }</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    /*</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">     * recursively build the comment tree for given root node</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">     * @param array $data array with comments data</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">     * @int $rootID root node id</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">     * @return Comment array </td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">     */</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    private function buildTree(&amp;$data, $rootID = 0) {</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        $tree = array();</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        foreach ($data as $id =&gt; $node) {</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            $node-&gt;parent_id = $node-&gt;parent_id === null ? 0 : $node-&gt;parent_id;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            if ($node-&gt;parent_id == $rootID) {</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">                unset($data[$id]);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">                $node-&gt;childs = $this-&gt;buildTree($data, $node-&gt;id);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">                $tree[] = $node;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            }</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        }</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        return $tree;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    }</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    /*</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">     * returns the string, which represents comment's creator</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">     * @return string </td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">     */</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    public function getUserName() {</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        if (isset($this-&gt;user)) {</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            //if User model has been configured and comment posted by registered user</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            $userConfig = Yii::app()-&gt;getModule('comments')-&gt;userConfig;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            return $this-&gt;user-&gt;$userConfig['nameProperty'];</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        }</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        return $this-&gt;user_name;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    }</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    /*</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">     * returns the string, which represents email of the user that commented</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">     * @return string</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">     */</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    public function getEmail() {</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        if (isset($this-&gt;user)) {</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            //if User model has been configured and comment posted by registered user</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            $userConfig = Yii::app()-&gt;getModule('comments')-&gt;userConfig;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            if (isset($userConfig['emailProperty']))</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">                return $this-&gt;user-&gt;$userConfig['emailProperty'];</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        }</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        return $this-&gt;user_email;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    }</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    /*</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">     * @return array</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">     */</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    public function getConfig() {</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        if ($this-&gt;_config === null) {</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            //get comments module</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            $commentsModule = Yii::app()-&gt;getModule('comments');</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            $this-&gt;_config = $commentsModule-&gt;getModelConfig($this-&gt;owner_name);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        }</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        return $this-&gt;_config;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    }</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    /*</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">     * Returns the number of comments for a particular model</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">     * @return integer $count</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">     */</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    public function getCommentCount($owner_name, $owner_id) {</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        $max = Yii::app()-&gt;db-&gt;createCommand()</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">                -&gt;select('MAX(`count`)')</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">                -&gt;from($this-&gt;tableName())</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">                -&gt;where('owner_id=:owner_id AND owner_name=:owner_name', array(':owner_id' =&gt; $owner_id, ':owner_name' =&gt; $owner_name))</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">                -&gt;queryScalar();</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        return $max + 1;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    }</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    /*</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">     * Returns comments owner model</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">     * @return CActiveRecord $model</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">     */</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    public function getOwnerModel() {</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        if ($this-&gt;_ownerModel === false) {</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            if (is_array($primaryKey = $this-&gt;primaryKey()) === false)</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">                $key = $this-&gt;owner_id;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            else</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">                $key = array_combine($primaryKey, explode('.', $this-&gt;owner_id));</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            $ownerModel = $this-&gt;owner_name;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            if (class_exists($ownerModel))</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">                $this-&gt;_ownerModel = $ownerModel::model()-&gt;findByPk($key);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            else</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">                $this-&gt;_ownerModel = null;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        }</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        return $this-&gt;_ownerModel;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    }</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    /*</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">     * Set comment and all his childs as deleted</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">     * @return boolean</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">     */</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    public function setDeleted() {</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        /* todo add deleting for childs */</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        $this-&gt;status = self::STATUS_DELETED;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        return $this-&gt;update();</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    }</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    /*</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">     * Sets comment as approved</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">     * @return boolean</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">     */</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    public function setApproved() {</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        $this-&gt;status = self::STATUS_APPROVED;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        return $this-&gt;update();</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    }</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    public function setDisapproved() {</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        $this-&gt;status = self::STATUS_NOT_APPROVED;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        return $this-&gt;update();</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    }</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    /**</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">     * Get text representation of comment's status</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">     * @return string</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">     */</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    public function getTextStatus() {</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        $this-&gt;status = $this-&gt;status === null ? 0 : $this-&gt;status;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        return Yii::t('CommentsModule.msg', $this-&gt;_statuses[$this-&gt;status]);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    }</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    /**</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">     * Generate data with statuses for dropDownList</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">     * @return array</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">     */</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    public function getStatuses() {</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        return $this-&gt;_statuses;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    }</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    /**</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">     * Get the link to page with this comment</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">     * @return string</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">     */</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    public function getPageUrl() {</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        $config = $this-&gt;config;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        //if isset settings for comments page url</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        if (isset($config['pageUrl']) === true &amp;&amp; is_array($config['pageUrl']) === true) {</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            $ownerModel = $this-&gt;getOwnerModel();</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            $routeData = array();</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            foreach ($config['pageUrl']['data'] as $routeVar =&gt; $modelProperty)</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">                $routeData[$routeVar] = $ownerModel-&gt;$modelProperty;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            return Yii::app()-&gt;urlManager-&gt;createUrl($config['pageUrl']['route'], $routeData) . "#comment-$this-&gt;id";</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        }</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        return null;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    }</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    /*</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">     * Set comment status base on owner model configuration</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">     */</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    public function beforeSave() {</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        //if current user is superuser, then automoderate comment and it's new comment</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        if ($this-&gt;isNewRecord === true &amp;&amp; $this-&gt;evaluateExpression($this-&gt;config['isSuperuser']) === true)</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            $this-&gt;status = self::STATUS_APPROVED;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        return parent::beforeSave();</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    }</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">}</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"></td></tr></tbody></table></body></html>